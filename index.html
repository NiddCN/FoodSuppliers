<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <title>Sheffield Region Food Providers</title>
    <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            background-color: #ffffff;
        }
        .custom-icon {
            width: 32px;
            height: 32px;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <!-- PapaParse JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the map
            var map = L.map('map', {
                zoomControl: true,
                maxZoom: 28,
                minZoom: 1
            }).fitBounds([[51.309921611957684, -5.91187082409157], [54.89024731466568, 3.099690653347797]]);
            
            L.tileLayer('http://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                opacity: 1.0,
                attribution: '<a href="https://www.openstreetmap.org/copyright">Â© OpenStreetMap contributors, CC-BY-SA</a>',
                minZoom: 1,
                maxZoom: 28
            }).addTo(map);

            // Define custom icons for categories
            var categoryIcons = {
                "Ready to eat meals": 'https://raw.githubusercontent.com/NiddCN/FoodSuppliers/main/Symbols/readymeal.svg',   
                "Specialist diet supplies": 'https://raw.githubusercontent.com/NiddCN/FoodSuppliers/main/Symbols/Halal.svg', 
                "Frozen foods": 'https://raw.githubusercontent.com/NiddCN/FoodSuppliers/main/Symbols/frozenfood.svg',
                "Protein": 'https://raw.githubusercontent.com/NiddCN/FoodSuppliers/main/Symbols/protein.svg',   
                "Dairy and milk products": 'https://raw.githubusercontent.com/NiddCN/FoodSuppliers/main/Symbols/dairy.svg', 
                "Bakery": 'https://raw.githubusercontent.com/NiddCN/FoodSuppliers/75f5e54b0473f6808bb5e4858f576c3e1a68b3f7/Symbols/bread.svg',
                "Catering Supplies": 'https://raw.githubusercontent.com/NiddCN/FoodSuppliers/main/Symbols/cateringsupplies.svg',
                "Waste": 'https://raw.githubusercontent.com/NiddCN/FoodSuppliers/main/Symbols/waste.svg'
            };

            // Fetch and parse CSV data
            var csvUrl = 'https://docs.google.com/spreadsheets/d/16Nu_nQpB5t10gTV9HsYirQEPUQQ-7leW4eGWzE_Tt5A/gviz/tq?tqx=out:csv&sheet=Sheet1';
            
            Papa.parse(csvUrl, {
                download: true,
                header: true,
                complete: function(results) {
                    var data = results.data;
                    data.forEach(function(row) {
                        var lat = parseFloat(row.lat);   
                        var lng = parseFloat(row.long); 
                        if (!isNaN(lat) && !isNaN(lng)) {
                            // Determine the appropriate icon based on category
                            var category = row.Category || 'Default'; // Default if Category is missing
                            var iconUrl = categoryIcons[category] || 'https://raw.githubusercontent.com/NiddCN/FoodSuppliers/main/Symbols/default.svg'; // Default icon

                            var customIcon = L.icon({
                                iconUrl: iconUrl,
                                iconSize: [32, 32], // Size of the icon
                                iconAnchor: [16, 32], // Anchor point of the icon
                                popupAnchor: [0, -32] // Anchor point of the popup
                            });

                            var marker = L.marker([lat, lng], { icon: customIcon }).addTo(map);
                            var popupContent = [
                                '<b>Supplier Name:</b> ' + (row.Supplier || 'N/A'),
                                '<b>Category:</b> ' + (row.Category || 'N/A'),
                                '<b>Website:</b> <a href="' + (row.Website || '#') + '" target="_blank">' + (row.Website || 'N/A') + '</a>',
                                '<b>Email:</b> <a href="mailto:' + (row.Email || '') + '">' + (row.Email || 'N/A') + '</a>',
                                '<b>Contact Number:</b> ' + (row.ContactNum || 'N/A')
                            ].join('<br>');  // Join the array elements with a line break

                            marker.bindPopup(popupContent);
                        }
                    });
                },
                error: function(err) {
                    console.error('Error fetching or parsing data:', err);
                }
            });
        });
    </script>
</body>
</html>
